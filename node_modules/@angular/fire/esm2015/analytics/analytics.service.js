/**
 * @fileoverview added by tsickle
 * Generated from: analytics.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ComponentFactoryResolver, Inject, Injectable, Injector, NgModuleFactory, NgZone, Optional, PLATFORM_ID } from '@angular/core';
import { from, Observable, of } from 'rxjs';
import { filter, groupBy, map, mergeMap, observeOn, pairwise, startWith, switchMap, tap, withLatestFrom } from 'rxjs/operators';
import { ActivationEnd, NavigationEnd, Router, ROUTES } from '@angular/router';
import { ɵAngularFireSchedulers } from '@angular/fire';
import { AngularFireAnalytics, DEBUG_MODE } from './analytics';
import { Title } from '@angular/platform-browser';
import { isPlatformBrowser, isPlatformServer } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "./analytics";
import * as i2 from "@angular/router";
import * as i3 from "@angular/platform-browser";
/** @type {?} */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './analytics';
import * as ɵngcc2 from '@angular/router';
import * as ɵngcc3 from '@angular/platform-browser';
const FIREBASE_EVENT_ORIGIN_KEY = 'firebase_event_origin';
/** @type {?} */
const FIREBASE_PREVIOUS_SCREEN_CLASS_KEY = 'firebase_previous_class';
/** @type {?} */
const FIREBASE_PREVIOUS_SCREEN_INSTANCE_ID_KEY = 'firebase_previous_id';
/** @type {?} */
const FIREBASE_PREVIOUS_SCREEN_NAME_KEY = 'firebase_previous_screen';
/** @type {?} */
const FIREBASE_SCREEN_CLASS_KEY = 'firebase_screen_class';
/** @type {?} */
const FIREBASE_SCREEN_INSTANCE_ID_KEY = 'firebase_screen_id';
/** @type {?} */
const FIREBASE_SCREEN_NAME_KEY = 'firebase_screen';
/** @type {?} */
const OUTLET_KEY = 'outlet';
/** @type {?} */
const PAGE_PATH_KEY = 'page_path';
/** @type {?} */
const PAGE_TITLE_KEY = 'page_title';
/** @type {?} */
const SCREEN_CLASS_KEY = 'screen_class';
/** @type {?} */
const SCREEN_NAME_KEY = 'screen_name';
/** @type {?} */
const SCREEN_VIEW_EVENT = 'screen_view';
/** @type {?} */
const EVENT_ORIGIN_AUTO = 'auto';
/** @type {?} */
const DEFAULT_SCREEN_CLASS = '???';
/** @type {?} */
const NG_PRIMARY_OUTLET = 'primary';
/** @type {?} */
const SCREEN_INSTANCE_DELIMITER = '#';
/** @type {?} */
const ANNOTATIONS = '__annotations__';
// this is an INT64 in iOS/Android but use INT32 cause javascript
/** @type {?} */
let nextScreenInstanceID = Math.floor(Math.random() * (Math.pow(2, 32) - 1)) - Math.pow(2, 31);
/** @type {?} */
const knownScreenInstanceIDs = {};
/** @type {?} */
const getScreenInstanceID = (/**
 * @param {?} params
 * @return {?}
 */
(params) => {
    // unique the screen class against the outlet name
    /** @type {?} */
    const screenInstanceKey = [
        params[SCREEN_CLASS_KEY],
        params[OUTLET_KEY]
    ].join(SCREEN_INSTANCE_DELIMITER);
    if (knownScreenInstanceIDs.hasOwnProperty(screenInstanceKey)) {
        return knownScreenInstanceIDs[screenInstanceKey];
    }
    else {
        /** @type {?} */
        const ret = nextScreenInstanceID++;
        knownScreenInstanceIDs[screenInstanceKey] = ret;
        return ret;
    }
});
const ɵ0 = getScreenInstanceID;
export class ScreenTrackingService {
    /**
     * @param {?} analytics
     * @param {?} router
     * @param {?} title
     * @param {?} componentFactoryResolver
     * @param {?} platformId
     * @param {?} debugModeEnabled
     * @param {?} zone
     * @param {?} injector
     */
    constructor(analytics, router, title, componentFactoryResolver, 
    // tslint:disable-next-line:ban-types
    platformId, debugModeEnabled, zone, injector) {
        if (!router || !isPlatformBrowser(platformId)) {
            return this;
        }
        zone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const activationEndEvents = router.events.pipe(filter((/**
             * @param {?} e
             * @return {?}
             */
            e => e instanceof ActivationEnd)));
            /** @type {?} */
            const navigationEndEvents = router.events.pipe(filter((/**
             * @param {?} e
             * @return {?}
             */
            e => e instanceof NavigationEnd)));
            this.disposable = navigationEndEvents.pipe(withLatestFrom(activationEndEvents), switchMap((/**
             * @param {?} __0
             * @return {?}
             */
            ([navigationEnd, activationEnd]) => {
                // SEMVER: start using optional chains and nullish coalescing once we support newer typescript
                /** @type {?} */
                const pagePath = navigationEnd.url;
                /** @type {?} */
                const screenName = activationEnd.snapshot.routeConfig && activationEnd.snapshot.routeConfig.path || pagePath;
                /** @type {?} */
                const params = {
                    [SCREEN_NAME_KEY]: screenName,
                    [PAGE_PATH_KEY]: pagePath,
                    [FIREBASE_EVENT_ORIGIN_KEY]: EVENT_ORIGIN_AUTO,
                    [FIREBASE_SCREEN_NAME_KEY]: screenName,
                    [OUTLET_KEY]: activationEnd.snapshot.outlet
                };
                if (title) {
                    params[PAGE_TITLE_KEY] = title.getTitle();
                }
                /** @type {?} */
                const component = activationEnd.snapshot.component;
                /** @type {?} */
                const routeConfig = activationEnd.snapshot.routeConfig;
                /** @type {?} */
                const loadChildren = routeConfig && routeConfig.loadChildren;
                // TODO figure out how to handle minification
                if (typeof loadChildren === 'string') {
                    // SEMVER: this is the older lazy load style "./path#ClassName", drop this when we drop old ng
                    // TODO is it worth seeing if I can look up the component factory selector from the module name?
                    // it's lazy so it's not registered with componentFactoryResolver yet... seems a pain for a depreciated style
                    return of(Object.assign(Object.assign({}, params), { [SCREEN_CLASS_KEY]: loadChildren.split('#')[1] }));
                }
                else if (typeof component === 'string') {
                    return of(Object.assign(Object.assign({}, params), { [SCREEN_CLASS_KEY]: component }));
                }
                else if (component) {
                    /** @type {?} */
                    const componentFactory = componentFactoryResolver.resolveComponentFactory(component);
                    return of(Object.assign(Object.assign({}, params), { [SCREEN_CLASS_KEY]: componentFactory.selector }));
                }
                else if (loadChildren) {
                    /** @type {?} */
                    const loadedChildren = loadChildren();
                    /** @type {?} */
                    const loadedChildren$ = (loadedChildren instanceof Observable) ?
                        loadedChildren :
                        from(Promise.resolve(loadedChildren));
                    return loadedChildren$.pipe(map((/**
                     * @param {?} lazyModule
                     * @return {?}
                     */
                    lazyModule => {
                        if (lazyModule instanceof NgModuleFactory) {
                            // AOT create an injector
                            /** @type {?} */
                            const moduleRef = lazyModule.create(injector);
                            // INVESTIGATE is this the right way to get at the matching route?
                            /** @type {?} */
                            const routes = moduleRef.injector.get(ROUTES);
                            /** @type {?} */
                            const component = routes[0][0].component;
                            try {
                                /** @type {?} */
                                const componentFactory = moduleRef.componentFactoryResolver.resolveComponentFactory(component);
                                return Object.assign(Object.assign({}, params), { [SCREEN_CLASS_KEY]: componentFactory.selector });
                            }
                            catch (_) {
                                return Object.assign(Object.assign({}, params), { [SCREEN_CLASS_KEY]: DEFAULT_SCREEN_CLASS });
                            }
                        }
                        else {
                            // JIT look at the annotations
                            // INVESTIGATE are there public APIs for this stuff?
                            /** @type {?} */
                            const declarations = [].concat.apply([], (lazyModule[ANNOTATIONS] || []).map((/**
                             * @param {?} f
                             * @return {?}
                             */
                            (f) => f.declarations)));
                            /** @type {?} */
                            const selectors = [].concat.apply([], declarations.map((/**
                             * @param {?} c
                             * @return {?}
                             */
                            (c) => (c[ANNOTATIONS] || []).map((/**
                             * @param {?} f
                             * @return {?}
                             */
                            (f) => f.selector)))));
                            // should I just be grabbing the selector like this or should i match against the route component?
                            //   const routerModule = lazyModule.ngInjectorDef.imports.find(i => i.ngModule && ....);
                            //   const route = routerModule.providers[0].find(p => p.provide == ROUTES).useValue[0];
                            return Object.assign(Object.assign({}, params), { [SCREEN_CLASS_KEY]: selectors[0] || DEFAULT_SCREEN_CLASS });
                        }
                    })));
                }
                else {
                    return of(Object.assign(Object.assign({}, params), { [SCREEN_CLASS_KEY]: DEFAULT_SCREEN_CLASS }));
                }
            })), map((/**
             * @param {?} params
             * @return {?}
             */
            params => (Object.assign({ [FIREBASE_SCREEN_CLASS_KEY]: params[SCREEN_CLASS_KEY], [FIREBASE_SCREEN_INSTANCE_ID_KEY]: getScreenInstanceID(params) }, params)))), tap((/**
             * @param {?} params
             * @return {?}
             */
            params => {
                // TODO perhaps I can be smarter about this, bubble events up to the nearest outlet?
                if (params[OUTLET_KEY] === NG_PRIMARY_OUTLET) {
                    analytics.setCurrentScreen(params[SCREEN_NAME_KEY]);
                    analytics.updateConfig({
                        [PAGE_PATH_KEY]: params[PAGE_PATH_KEY],
                        [SCREEN_CLASS_KEY]: params[SCREEN_CLASS_KEY]
                    });
                    if (title) {
                        analytics.updateConfig({ [PAGE_TITLE_KEY]: params[PAGE_TITLE_KEY] });
                    }
                }
            })), groupBy((/**
             * @param {?} params
             * @return {?}
             */
            params => params[OUTLET_KEY])), 
            // tslint:disable-next-line
            mergeMap((/**
             * @param {?} group
             * @return {?}
             */
            group => group.pipe(startWith(undefined), pairwise()))), map((/**
             * @param {?} __0
             * @return {?}
             */
            ([prior, current]) => prior ? Object.assign({ [FIREBASE_PREVIOUS_SCREEN_CLASS_KEY]: prior[SCREEN_CLASS_KEY], [FIREBASE_PREVIOUS_SCREEN_NAME_KEY]: prior[SCREEN_NAME_KEY], [FIREBASE_PREVIOUS_SCREEN_INSTANCE_ID_KEY]: prior[FIREBASE_SCREEN_INSTANCE_ID_KEY] }, current) : current)), 
            // tslint:disable-next-line:no-console
            tap((/**
             * @param {?} params
             * @return {?}
             */
            params => debugModeEnabled && console.info(SCREEN_VIEW_EVENT, params))), tap((/**
             * @param {?} params
             * @return {?}
             */
            params => zone.runOutsideAngular((/**
             * @return {?}
             */
            () => analytics.logEvent(SCREEN_VIEW_EVENT, params)))))).subscribe();
        }));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.disposable) {
            this.disposable.unsubscribe();
        }
    }
}
ScreenTrackingService.ɵfac = function ScreenTrackingService_Factory(t) { return new (t || ScreenTrackingService)(ɵngcc0.ɵɵinject(ɵngcc1.AngularFireAnalytics), ɵngcc0.ɵɵinject(ɵngcc2.Router, 8), ɵngcc0.ɵɵinject(ɵngcc3.Title, 8), ɵngcc0.ɵɵinject(ɵngcc0.ComponentFactoryResolver), ɵngcc0.ɵɵinject(PLATFORM_ID), ɵngcc0.ɵɵinject(DEBUG_MODE, 8), ɵngcc0.ɵɵinject(ɵngcc0.NgZone), ɵngcc0.ɵɵinject(ɵngcc0.Injector)); };
/** @nocollapse */
ScreenTrackingService.ctorParameters = () => [
    { type: AngularFireAnalytics },
    { type: Router, decorators: [{ type: Optional }] },
    { type: Title, decorators: [{ type: Optional }] },
    { type: ComponentFactoryResolver },
    { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] },
    { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [DEBUG_MODE,] }] },
    { type: NgZone },
    { type: Injector }
];
/** @nocollapse */ ScreenTrackingService.ɵprov = i0.ɵɵdefineInjectable({ factory: function ScreenTrackingService_Factory() { return new ScreenTrackingService(i0.ɵɵinject(i1.AngularFireAnalytics), i0.ɵɵinject(i2.Router, 8), i0.ɵɵinject(i3.Title, 8), i0.ɵɵinject(i0.ComponentFactoryResolver), i0.ɵɵinject(i0.PLATFORM_ID), i0.ɵɵinject(i1.DEBUG_MODE, 8), i0.ɵɵinject(i0.NgZone), i0.ɵɵinject(i0.INJECTOR)); }, token: ScreenTrackingService, providedIn: "any" });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ScreenTrackingService, [{
        type: Injectable,
        args: [{
                providedIn: 'any'
            }]
    }], function () { return [{ type: ɵngcc1.AngularFireAnalytics }, { type: ɵngcc2.Router, decorators: [{
                type: Optional
            }] }, { type: ɵngcc3.Title, decorators: [{
                type: Optional
            }] }, { type: ɵngcc0.ComponentFactoryResolver }, { type: Object, decorators: [{
                type: Inject,
                args: [PLATFORM_ID]
            }] }, { type: undefined, decorators: [{
                type: Optional
            }, {
                type: Inject,
                args: [DEBUG_MODE]
            }] }, { type: ɵngcc0.NgZone }, { type: ɵngcc0.Injector }]; }, null); })();
if (false) {
    /**
     * @type {?}
     * @private
     */
    ScreenTrackingService.prototype.disposable;
}
export class UserTrackingService {
    // TODO a user properties injector
    /**
     * @param {?} analytics
     * @param {?} zone
     * @param {?} platformId
     */
    constructor(analytics, zone, 
    // tslint:disable-next-line:ban-types
    platformId) {
        /** @type {?} */
        const schedulers = new ɵAngularFireSchedulers(zone);
        if (!isPlatformServer(platformId)) {
            zone.runOutsideAngular((/**
             * @return {?}
             */
            () => {
                // @ts-ignore zap the import in the UMD
                this.disposable = from(import('firebase/auth')).pipe(observeOn(schedulers.outsideAngular), switchMap((/**
                 * @return {?}
                 */
                () => analytics.app)), map((/**
                 * @param {?} app
                 * @return {?}
                 */
                app => app.auth())), switchMap((/**
                 * @param {?} auth
                 * @return {?}
                 */
                auth => new Observable(auth.onAuthStateChanged.bind(auth)))), switchMap((/**
                 * @param {?} user
                 * @return {?}
                 */
                user => analytics.setUserId(user ? user.uid : null)))).subscribe();
            }));
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.disposable) {
            this.disposable.unsubscribe();
        }
    }
}
UserTrackingService.ɵfac = function UserTrackingService_Factory(t) { return new (t || UserTrackingService)(ɵngcc0.ɵɵinject(ɵngcc1.AngularFireAnalytics), ɵngcc0.ɵɵinject(ɵngcc0.NgZone), ɵngcc0.ɵɵinject(PLATFORM_ID)); };
/** @nocollapse */
UserTrackingService.ctorParameters = () => [
    { type: AngularFireAnalytics },
    { type: NgZone },
    { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
];
/** @nocollapse */ UserTrackingService.ɵprov = i0.ɵɵdefineInjectable({ factory: function UserTrackingService_Factory() { return new UserTrackingService(i0.ɵɵinject(i1.AngularFireAnalytics), i0.ɵɵinject(i0.NgZone), i0.ɵɵinject(i0.PLATFORM_ID)); }, token: UserTrackingService, providedIn: "any" });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(UserTrackingService, [{
        type: Injectable,
        args: [{
                providedIn: 'any'
            }]
    }], function () { return [{ type: ɵngcc1.AngularFireAnalytics }, { type: ɵngcc0.NgZone }, { type: Object, decorators: [{
                type: Inject,
                args: [PLATFORM_ID]
            }] }]; }, null); })();
if (false) {
    /**
     * @type {?}
     * @private
     */
    UserTrackingService.prototype.disposable;
}
export { ɵ0 };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5hbHl0aWNzLnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hbmFseXRpY3MvYW5hbHl0aWNzLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQ0wsd0JBQXdCLEVBQ3hCLE1BQU0sRUFDTixVQUFVLEVBQ1YsUUFBUSxFQUNSLGVBQWUsRUFDZixNQUFNLEVBRU4sUUFBUSxFQUNSLFdBQVcsRUFDWixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxFQUFFLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQzFELE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxjQUFjLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNoSSxPQUFPLEVBQUUsYUFBYSxFQUFFLGFBQWEsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0UsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxVQUFVLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFL0QsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3RFO0FBQ29DO0FBQ3hCO0FBQXVDO0FBQ3JCOzs7OztBQUFpQixNQUZ6Qyx5QkFBeUIsR0FBRyx1QkFBdUI7QUFDekQ7QUFBaUIsTUFBWCxrQ0FBa0MsR0FBRyx5QkFBeUI7QUFDcEU7QUFBaUIsTUFBWCx3Q0FBd0MsR0FBRyxzQkFBc0I7QUFDdkU7QUFBaUIsTUFBWCxpQ0FBaUMsR0FBRywwQkFBMEI7QUFDcEU7QUFBaUIsTUFBWCx5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QUFBUTtBQUFpQjtBQUFnQjtBQUNsQyxJQWpCTCx5Q0FBNkM7QUFDL0M7QUFDQztBQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICBJbmplY3QsXG4gIEluamVjdGFibGUsXG4gIEluamVjdG9yLFxuICBOZ01vZHVsZUZhY3RvcnksXG4gIE5nWm9uZSxcbiAgT25EZXN0cm95LFxuICBPcHRpb25hbCxcbiAgUExBVEZPUk1fSURcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBmcm9tLCBPYnNlcnZhYmxlLCBvZiwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIGdyb3VwQnksIG1hcCwgbWVyZ2VNYXAsIG9ic2VydmVPbiwgcGFpcndpc2UsIHN0YXJ0V2l0aCwgc3dpdGNoTWFwLCB0YXAsIHdpdGhMYXRlc3RGcm9tIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQWN0aXZhdGlvbkVuZCwgTmF2aWdhdGlvbkVuZCwgUm91dGVyLCBST1VURVMgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgybVBbmd1bGFyRmlyZVNjaGVkdWxlcnMgfSBmcm9tICdAYW5ndWxhci9maXJlJztcbmltcG9ydCB7IEFuZ3VsYXJGaXJlQW5hbHl0aWNzLCBERUJVR19NT0RFIH0gZnJvbSAnLi9hbmFseXRpY3MnO1xuaW1wb3J0IHsgVXNlciB9IGZyb20gJ2ZpcmViYXNlL2FwcCc7XG5pbXBvcnQgeyBUaXRsZSB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xuaW1wb3J0IHsgaXNQbGF0Zm9ybUJyb3dzZXIsIGlzUGxhdGZvcm1TZXJ2ZXIgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuXG5jb25zdCBGSVJFQkFTRV9FVkVOVF9PUklHSU5fS0VZID0gJ2ZpcmViYXNlX2V2ZW50X29yaWdpbic7XG5jb25zdCBGSVJFQkFTRV9QUkVWSU9VU19TQ1JFRU5fQ0xBU1NfS0VZID0gJ2ZpcmViYXNlX3ByZXZpb3VzX2NsYXNzJztcbmNvbnN0IEZJUkVCQVNFX1BSRVZJT1VTX1NDUkVFTl9JTlNUQU5DRV9JRF9LRVkgPSAnZmlyZWJhc2VfcHJldmlvdXNfaWQnO1xuY29uc3QgRklSRUJBU0VfUFJFVklPVVNfU0NSRUVOX05BTUVfS0VZID0gJ2ZpcmViYXNlX3ByZXZpb3VzX3NjcmVlbic7XG5jb25zdCBGSVJFQkFTRV9TQ1JFRU5fQ0xBU1NfS0VZID0gJ2ZpcmViYXNlX3NjcmVlbl9jbGFzcyc7XG5jb25zdCBGSVJFQkFTRV9TQ1JFRU5fSU5TVEFOQ0VfSURfS0VZID0gJ2ZpcmViYXNlX3NjcmVlbl9pZCc7XG5jb25zdCBGSVJFQkFTRV9TQ1JFRU5fTkFNRV9LRVkgPSAnZmlyZWJhc2Vfc2NyZWVuJztcbmNvbnN0IE9VVExFVF9LRVkgPSAnb3V0bGV0JztcbmNvbnN0IFBBR0VfUEFUSF9LRVkgPSAncGFnZV9wYXRoJztcbmNvbnN0IFBBR0VfVElUTEVfS0VZID0gJ3BhZ2VfdGl0bGUnO1xuY29uc3QgU0NSRUVOX0NMQVNTX0tFWSA9ICdzY3JlZW5fY2xhc3MnO1xuY29uc3QgU0NSRUVOX05BTUVfS0VZID0gJ3NjcmVlbl9uYW1lJztcblxuY29uc3QgU0NSRUVOX1ZJRVdfRVZFTlQgPSAnc2NyZWVuX3ZpZXcnO1xuY29uc3QgRVZFTlRfT1JJR0lOX0FVVE8gPSAnYXV0byc7XG5jb25zdCBERUZBVUxUX1NDUkVFTl9DTEFTUyA9ICc/Pz8nO1xuY29uc3QgTkdfUFJJTUFSWV9PVVRMRVQgPSAncHJpbWFyeSc7XG5jb25zdCBTQ1JFRU5fSU5TVEFOQ0VfREVMSU1JVEVSID0gJyMnO1xuXG5jb25zdCBBTk5PVEFUSU9OUyA9ICdfX2Fubm90YXRpb25zX18nO1xuXG5cbi8vIHRoaXMgaXMgYW4gSU5UNjQgaW4gaU9TL0FuZHJvaWQgYnV0IHVzZSBJTlQzMiBjYXVzZSBqYXZhc2NyaXB0XG5sZXQgbmV4dFNjcmVlbkluc3RhbmNlSUQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMiAqKiAzMiAtIDEpKSAtIDIgKiogMzE7XG5cbmNvbnN0IGtub3duU2NyZWVuSW5zdGFuY2VJRHM6IHsgW2tleTogc3RyaW5nXTogbnVtYmVyIH0gPSB7fTtcblxuY29uc3QgZ2V0U2NyZWVuSW5zdGFuY2VJRCA9IChwYXJhbXM6IHsgW2tleTogc3RyaW5nXTogYW55IH0pID0+IHtcbiAgLy8gdW5pcXVlIHRoZSBzY3JlZW4gY2xhc3MgYWdhaW5zdCB0aGUgb3V0bGV0IG5hbWVcbiAgY29uc3Qgc2NyZWVuSW5zdGFuY2VLZXkgPSBbXG4gICAgcGFyYW1zW1NDUkVFTl9DTEFTU19LRVldLFxuICAgIHBhcmFtc1tPVVRMRVRfS0VZXVxuICBdLmpvaW4oU0NSRUVOX0lOU1RBTkNFX0RFTElNSVRFUik7XG4gIGlmIChrbm93blNjcmVlbkluc3RhbmNlSURzLmhhc093blByb3BlcnR5KHNjcmVlbkluc3RhbmNlS2V5KSkge1xuICAgIHJldHVybiBrbm93blNjcmVlbkluc3RhbmNlSURzW3NjcmVlbkluc3RhbmNlS2V5XTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCByZXQgPSBuZXh0U2NyZWVuSW5zdGFuY2VJRCsrO1xuICAgIGtub3duU2NyZWVuSW5zdGFuY2VJRHNbc2NyZWVuSW5zdGFuY2VLZXldID0gcmV0O1xuICAgIHJldHVybiByZXQ7XG4gIH1cbn07XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ2FueSdcbn0pXG5leHBvcnQgY2xhc3MgU2NyZWVuVHJhY2tpbmdTZXJ2aWNlIGltcGxlbWVudHMgT25EZXN0cm95IHtcblxuICBwcml2YXRlIGRpc3Bvc2FibGU6IFN1YnNjcmlwdGlvbiB8IHVuZGVmaW5lZDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBhbmFseXRpY3M6IEFuZ3VsYXJGaXJlQW5hbHl0aWNzLFxuICAgIEBPcHRpb25hbCgpIHJvdXRlcjogUm91dGVyLFxuICAgIEBPcHRpb25hbCgpIHRpdGxlOiBUaXRsZSxcbiAgICBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6YmFuLXR5cGVzXG4gICAgQEluamVjdChQTEFURk9STV9JRCkgcGxhdGZvcm1JZDogT2JqZWN0LFxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoREVCVUdfTU9ERSkgZGVidWdNb2RlRW5hYmxlZDogYm9vbGVhbiB8IG51bGwsXG4gICAgem9uZTogTmdab25lLFxuICAgIGluamVjdG9yOiBJbmplY3RvclxuICApIHtcbiAgICBpZiAoIXJvdXRlciB8fCAhaXNQbGF0Zm9ybUJyb3dzZXIocGxhdGZvcm1JZCkpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICB6b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIGNvbnN0IGFjdGl2YXRpb25FbmRFdmVudHMgPSByb3V0ZXIuZXZlbnRzLnBpcGUoZmlsdGVyPEFjdGl2YXRpb25FbmQ+KGUgPT4gZSBpbnN0YW5jZW9mIEFjdGl2YXRpb25FbmQpKTtcbiAgICAgIGNvbnN0IG5hdmlnYXRpb25FbmRFdmVudHMgPSByb3V0ZXIuZXZlbnRzLnBpcGUoZmlsdGVyPE5hdmlnYXRpb25FbmQ+KGUgPT4gZSBpbnN0YW5jZW9mIE5hdmlnYXRpb25FbmQpKTtcbiAgICAgIHRoaXMuZGlzcG9zYWJsZSA9IG5hdmlnYXRpb25FbmRFdmVudHMucGlwZShcbiAgICAgICAgd2l0aExhdGVzdEZyb20oYWN0aXZhdGlvbkVuZEV2ZW50cyksXG4gICAgICAgIHN3aXRjaE1hcCgoW25hdmlnYXRpb25FbmQsIGFjdGl2YXRpb25FbmRdKSA9PiB7XG4gICAgICAgICAgLy8gU0VNVkVSOiBzdGFydCB1c2luZyBvcHRpb25hbCBjaGFpbnMgYW5kIG51bGxpc2ggY29hbGVzY2luZyBvbmNlIHdlIHN1cHBvcnQgbmV3ZXIgdHlwZXNjcmlwdFxuICAgICAgICAgIGNvbnN0IHBhZ2VQYXRoID0gbmF2aWdhdGlvbkVuZC51cmw7XG4gICAgICAgICAgY29uc3Qgc2NyZWVuTmFtZSA9IGFjdGl2YXRpb25FbmQuc25hcHNob3Qucm91dGVDb25maWcgJiYgYWN0aXZhdGlvbkVuZC5zbmFwc2hvdC5yb3V0ZUNvbmZpZy5wYXRoIHx8IHBhZ2VQYXRoO1xuICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgICAgIFtTQ1JFRU5fTkFNRV9LRVldOiBzY3JlZW5OYW1lLFxuICAgICAgICAgICAgW1BBR0VfUEFUSF9LRVldOiBwYWdlUGF0aCxcbiAgICAgICAgICAgIFtGSVJFQkFTRV9FVkVOVF9PUklHSU5fS0VZXTogRVZFTlRfT1JJR0lOX0FVVE8sXG4gICAgICAgICAgICBbRklSRUJBU0VfU0NSRUVOX05BTUVfS0VZXTogc2NyZWVuTmFtZSxcbiAgICAgICAgICAgIFtPVVRMRVRfS0VZXTogYWN0aXZhdGlvbkVuZC5zbmFwc2hvdC5vdXRsZXRcbiAgICAgICAgICB9O1xuICAgICAgICAgIGlmICh0aXRsZSkge1xuICAgICAgICAgICAgcGFyYW1zW1BBR0VfVElUTEVfS0VZXSA9IHRpdGxlLmdldFRpdGxlKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGNvbXBvbmVudCA9IGFjdGl2YXRpb25FbmQuc25hcHNob3QuY29tcG9uZW50O1xuICAgICAgICAgIGNvbnN0IHJvdXRlQ29uZmlnID0gYWN0aXZhdGlvbkVuZC5zbmFwc2hvdC5yb3V0ZUNvbmZpZztcbiAgICAgICAgICBjb25zdCBsb2FkQ2hpbGRyZW4gPSByb3V0ZUNvbmZpZyAmJiByb3V0ZUNvbmZpZy5sb2FkQ2hpbGRyZW47XG4gICAgICAgICAgLy8gVE9ETyBmaWd1cmUgb3V0IGhvdyB0byBoYW5kbGUgbWluaWZpY2F0aW9uXG4gICAgICAgICAgaWYgKHR5cGVvZiBsb2FkQ2hpbGRyZW4gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAvLyBTRU1WRVI6IHRoaXMgaXMgdGhlIG9sZGVyIGxhenkgbG9hZCBzdHlsZSBcIi4vcGF0aCNDbGFzc05hbWVcIiwgZHJvcCB0aGlzIHdoZW4gd2UgZHJvcCBvbGQgbmdcbiAgICAgICAgICAgIC8vIFRPRE8gaXMgaXQgd29ydGggc2VlaW5nIGlmIEkgY2FuIGxvb2sgdXAgdGhlIGNvbXBvbmVudCBmYWN0b3J5IHNlbGVjdG9yIGZyb20gdGhlIG1vZHVsZSBuYW1lP1xuICAgICAgICAgICAgLy8gaXQncyBsYXp5IHNvIGl0J3Mgbm90IHJlZ2lzdGVyZWQgd2l0aCBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIgeWV0Li4uIHNlZW1zIGEgcGFpbiBmb3IgYSBkZXByZWNpYXRlZCBzdHlsZVxuICAgICAgICAgICAgcmV0dXJuIG9mKHsgLi4ucGFyYW1zLCBbU0NSRUVOX0NMQVNTX0tFWV06IGxvYWRDaGlsZHJlbi5zcGxpdCgnIycpWzFdIH0pO1xuICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbXBvbmVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiBvZih7IC4uLnBhcmFtcywgW1NDUkVFTl9DTEFTU19LRVldOiBjb21wb25lbnQgfSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChjb21wb25lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbXBvbmVudEZhY3RvcnkgPSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoY29tcG9uZW50KTtcbiAgICAgICAgICAgIHJldHVybiBvZih7IC4uLnBhcmFtcywgW1NDUkVFTl9DTEFTU19LRVldOiBjb21wb25lbnRGYWN0b3J5LnNlbGVjdG9yIH0pO1xuICAgICAgICAgIH0gZWxzZSBpZiAobG9hZENoaWxkcmVuKSB7XG4gICAgICAgICAgICBjb25zdCBsb2FkZWRDaGlsZHJlbiA9IGxvYWRDaGlsZHJlbigpO1xuICAgICAgICAgICAgY29uc3QgbG9hZGVkQ2hpbGRyZW4kOiBPYnNlcnZhYmxlPGFueT4gPSAobG9hZGVkQ2hpbGRyZW4gaW5zdGFuY2VvZiBPYnNlcnZhYmxlKSA/XG4gICAgICAgICAgICAgIGxvYWRlZENoaWxkcmVuIDpcbiAgICAgICAgICAgICAgZnJvbShQcm9taXNlLnJlc29sdmUobG9hZGVkQ2hpbGRyZW4pKTtcbiAgICAgICAgICAgIHJldHVybiBsb2FkZWRDaGlsZHJlbiQucGlwZShcbiAgICAgICAgICAgICAgbWFwKGxhenlNb2R1bGUgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChsYXp5TW9kdWxlIGluc3RhbmNlb2YgTmdNb2R1bGVGYWN0b3J5KSB7XG4gICAgICAgICAgICAgICAgICAvLyBBT1QgY3JlYXRlIGFuIGluamVjdG9yXG4gICAgICAgICAgICAgICAgICBjb25zdCBtb2R1bGVSZWYgPSBsYXp5TW9kdWxlLmNyZWF0ZShpbmplY3Rvcik7XG4gICAgICAgICAgICAgICAgICAvLyBJTlZFU1RJR0FURSBpcyB0aGlzIHRoZSByaWdodCB3YXkgdG8gZ2V0IGF0IHRoZSBtYXRjaGluZyByb3V0ZT9cbiAgICAgICAgICAgICAgICAgIGNvbnN0IHJvdXRlcyA9IG1vZHVsZVJlZi5pbmplY3Rvci5nZXQoUk9VVEVTKTtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBvbmVudCA9IHJvdXRlc1swXVswXS5jb21wb25lbnQ7IC8vIHNob3VsZCBpIGp1c3QgYmUgZ3JhYmJpbmcgMC0wIGhlcmU/XG4gICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wb25lbnRGYWN0b3J5ID0gbW9kdWxlUmVmLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShjb21wb25lbnQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5wYXJhbXMsIFtTQ1JFRU5fQ0xBU1NfS0VZXTogY29tcG9uZW50RmFjdG9yeS5zZWxlY3RvciB9O1xuICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoXykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5wYXJhbXMsIFtTQ1JFRU5fQ0xBU1NfS0VZXTogREVGQVVMVF9TQ1JFRU5fQ0xBU1MgfTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgLy8gSklUIGxvb2sgYXQgdGhlIGFubm90YXRpb25zXG4gICAgICAgICAgICAgICAgICAvLyBJTlZFU1RJR0FURSBhcmUgdGhlcmUgcHVibGljIEFQSXMgZm9yIHRoaXMgc3R1ZmY/XG4gICAgICAgICAgICAgICAgICBjb25zdCBkZWNsYXJhdGlvbnMgPSBbXS5jb25jYXQuYXBwbHkoW10sIChsYXp5TW9kdWxlW0FOTk9UQVRJT05TXSB8fCBbXSkubWFwKChmOiBhbnkpID0+IGYuZGVjbGFyYXRpb25zKSk7XG4gICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RvcnMgPSBbXS5jb25jYXQuYXBwbHkoW10sIGRlY2xhcmF0aW9ucy5tYXAoKGM6IGFueSkgPT4gKGNbQU5OT1RBVElPTlNdIHx8IFtdKS5tYXAoKGY6IGFueSkgPT4gZi5zZWxlY3RvcikpKTtcbiAgICAgICAgICAgICAgICAgIC8vIHNob3VsZCBJIGp1c3QgYmUgZ3JhYmJpbmcgdGhlIHNlbGVjdG9yIGxpa2UgdGhpcyBvciBzaG91bGQgaSBtYXRjaCBhZ2FpbnN0IHRoZSByb3V0ZSBjb21wb25lbnQ/XG4gICAgICAgICAgICAgICAgICAvLyAgIGNvbnN0IHJvdXRlck1vZHVsZSA9IGxhenlNb2R1bGUubmdJbmplY3RvckRlZi5pbXBvcnRzLmZpbmQoaSA9PiBpLm5nTW9kdWxlICYmIC4uLi4pO1xuICAgICAgICAgICAgICAgICAgLy8gICBjb25zdCByb3V0ZSA9IHJvdXRlck1vZHVsZS5wcm92aWRlcnNbMF0uZmluZChwID0+IHAucHJvdmlkZSA9PSBST1VURVMpLnVzZVZhbHVlWzBdO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgLi4ucGFyYW1zLCBbU0NSRUVOX0NMQVNTX0tFWV06IHNlbGVjdG9yc1swXSB8fCBERUZBVUxUX1NDUkVFTl9DTEFTUyB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBvZih7IC4uLnBhcmFtcywgW1NDUkVFTl9DTEFTU19LRVldOiBERUZBVUxUX1NDUkVFTl9DTEFTUyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pLFxuICAgICAgICBtYXAocGFyYW1zID0+ICh7XG4gICAgICAgICAgW0ZJUkVCQVNFX1NDUkVFTl9DTEFTU19LRVldOiBwYXJhbXNbU0NSRUVOX0NMQVNTX0tFWV0sXG4gICAgICAgICAgW0ZJUkVCQVNFX1NDUkVFTl9JTlNUQU5DRV9JRF9LRVldOiBnZXRTY3JlZW5JbnN0YW5jZUlEKHBhcmFtcyksXG4gICAgICAgICAgLi4ucGFyYW1zXG4gICAgICAgIH0pKSxcbiAgICAgICAgdGFwKHBhcmFtcyA9PiB7XG4gICAgICAgICAgLy8gVE9ETyBwZXJoYXBzIEkgY2FuIGJlIHNtYXJ0ZXIgYWJvdXQgdGhpcywgYnViYmxlIGV2ZW50cyB1cCB0byB0aGUgbmVhcmVzdCBvdXRsZXQ/XG4gICAgICAgICAgaWYgKHBhcmFtc1tPVVRMRVRfS0VZXSA9PT0gTkdfUFJJTUFSWV9PVVRMRVQpIHtcbiAgICAgICAgICAgIGFuYWx5dGljcy5zZXRDdXJyZW50U2NyZWVuKHBhcmFtc1tTQ1JFRU5fTkFNRV9LRVldKTtcbiAgICAgICAgICAgIGFuYWx5dGljcy51cGRhdGVDb25maWcoe1xuICAgICAgICAgICAgICBbUEFHRV9QQVRIX0tFWV06IHBhcmFtc1tQQUdFX1BBVEhfS0VZXSxcbiAgICAgICAgICAgICAgW1NDUkVFTl9DTEFTU19LRVldOiBwYXJhbXNbU0NSRUVOX0NMQVNTX0tFWV1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKHRpdGxlKSB7XG4gICAgICAgICAgICAgIGFuYWx5dGljcy51cGRhdGVDb25maWcoeyBbUEFHRV9USVRMRV9LRVldOiBwYXJhbXNbUEFHRV9USVRMRV9LRVldIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSksXG4gICAgICAgIGdyb3VwQnkocGFyYW1zID0+IHBhcmFtc1tPVVRMRVRfS0VZXSksXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZVxuICAgICAgICBtZXJnZU1hcChncm91cCA9PiBncm91cC5waXBlKHN0YXJ0V2l0aCh1bmRlZmluZWQpLCBwYWlyd2lzZSgpKSksXG4gICAgICAgIG1hcCgoW3ByaW9yLCBjdXJyZW50XSkgPT4gcHJpb3IgPyB7XG4gICAgICAgICAgW0ZJUkVCQVNFX1BSRVZJT1VTX1NDUkVFTl9DTEFTU19LRVldOiBwcmlvcltTQ1JFRU5fQ0xBU1NfS0VZXSxcbiAgICAgICAgICBbRklSRUJBU0VfUFJFVklPVVNfU0NSRUVOX05BTUVfS0VZXTogcHJpb3JbU0NSRUVOX05BTUVfS0VZXSxcbiAgICAgICAgICBbRklSRUJBU0VfUFJFVklPVVNfU0NSRUVOX0lOU1RBTkNFX0lEX0tFWV06IHByaW9yW0ZJUkVCQVNFX1NDUkVFTl9JTlNUQU5DRV9JRF9LRVldLFxuICAgICAgICAgIC4uLmN1cnJlbnRcbiAgICAgICAgfSA6IGN1cnJlbnQpLFxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tY29uc29sZVxuICAgICAgICB0YXAocGFyYW1zID0+IGRlYnVnTW9kZUVuYWJsZWQgJiYgY29uc29sZS5pbmZvKFNDUkVFTl9WSUVXX0VWRU5ULCBwYXJhbXMpKSxcbiAgICAgICAgdGFwKHBhcmFtcyA9PiB6b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IGFuYWx5dGljcy5sb2dFdmVudChTQ1JFRU5fVklFV19FVkVOVCwgcGFyYW1zKSkpXG4gICAgICApLnN1YnNjcmliZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuZGlzcG9zYWJsZSkge1xuICAgICAgdGhpcy5kaXNwb3NhYmxlLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbn1cblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAnYW55J1xufSlcbmV4cG9ydCBjbGFzcyBVc2VyVHJhY2tpbmdTZXJ2aWNlIGltcGxlbWVudHMgT25EZXN0cm95IHtcblxuICBwcml2YXRlIGRpc3Bvc2FibGU6IFN1YnNjcmlwdGlvbiB8IHVuZGVmaW5lZDtcblxuICAvLyBUT0RPIGEgdXNlciBwcm9wZXJ0aWVzIGluamVjdG9yXG4gIGNvbnN0cnVjdG9yKFxuICAgIGFuYWx5dGljczogQW5ndWxhckZpcmVBbmFseXRpY3MsXG4gICAgem9uZTogTmdab25lLFxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpiYW4tdHlwZXNcbiAgICBASW5qZWN0KFBMQVRGT1JNX0lEKSBwbGF0Zm9ybUlkOiBPYmplY3RcbiAgKSB7XG4gICAgY29uc3Qgc2NoZWR1bGVycyA9IG5ldyDJtUFuZ3VsYXJGaXJlU2NoZWR1bGVycyh6b25lKTtcblxuICAgIGlmICghaXNQbGF0Zm9ybVNlcnZlcihwbGF0Zm9ybUlkKSkge1xuICAgICAgem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmUgemFwIHRoZSBpbXBvcnQgaW4gdGhlIFVNRFxuICAgICAgICB0aGlzLmRpc3Bvc2FibGUgPSBmcm9tKGltcG9ydCgnZmlyZWJhc2UvYXV0aCcpKS5waXBlKFxuICAgICAgICAgIG9ic2VydmVPbihzY2hlZHVsZXJzLm91dHNpZGVBbmd1bGFyKSxcbiAgICAgICAgICBzd2l0Y2hNYXAoKCkgPT4gYW5hbHl0aWNzLmFwcCksXG4gICAgICAgICAgbWFwKGFwcCA9PiBhcHAuYXV0aCgpKSxcbiAgICAgICAgICBzd2l0Y2hNYXAoYXV0aCA9PiBuZXcgT2JzZXJ2YWJsZTxVc2VyIHwgbnVsbD4oYXV0aC5vbkF1dGhTdGF0ZUNoYW5nZWQuYmluZChhdXRoKSkpLFxuICAgICAgICAgIHN3aXRjaE1hcCh1c2VyID0+IGFuYWx5dGljcy5zZXRVc2VySWQodXNlciA/IHVzZXIudWlkIDogbnVsbCkpXG4gICAgICAgICkuc3Vic2NyaWJlKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5kaXNwb3NhYmxlKSB7XG4gICAgICB0aGlzLmRpc3Bvc2FibGUudW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==